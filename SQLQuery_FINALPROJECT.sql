------------DOWN----------

DROP TABLE IF EXISTS REQUEST
DROP TABLE IF EXISTS STATES
DROP TABLE IF EXISTS DONOR
DROP TABLE IF EXISTS PATIENT
DROP TABLE IF EXISTS PLASMA_BANK
DROP TABLE IF EXISTS USER_LOGIN
DROP TABLE IF EXISTS ADMIN_USER

 --------------------------------TABLES-----------------------------
-----------------UP----------------

CREATE TABLE ADMIN_USER(
ADMIN_ID INT,
AUTHENTICATE_USER INT NOT NULL,
CONSTRAINT ADMIN_PK PRIMARY KEY(ADMIN_ID)
);

CREATE TABLE USER_LOGIN(
USERNAME VARCHAR(20),
PASSWORD VARCHAR(20) NOT NULL,
ADMIN_ID INT,
CONSTRAINT USERNAME_PK PRIMARY KEY(USERNAME),
CONSTRAINT ADMIN_ID1_FK FOREIGN KEY(ADMIN_ID) REFERENCES ADMIN_USER(ADMIN_ID)
);

CREATE TABLE STATES(
    STATE_ID INT NOT NULL,
    STATE_NAME VARCHAR(10) NOT NULL,
    CONSTRAINT STATE_PK PRIMARY KEY(STATE_ID)
)

CREATE TABLE PATIENT(
NAME VARCHAR(20),
GENDER VARCHAR(20),
STATE_ID INT,
PATIENT_ID INT ,
REG_ID VARCHAR(10),
BLOOD_GROUP VARCHAR(20)  NOT NULL,
QUANTITY VARCHAR(10),
REG_DATE DATETIME,
PLASMA_ID INT,
PHONE_NO BIGINT NOT NULL,
AGE INT NOT NULL,
ADMIN_ID INT NOT NULL,
CONSTRAINT PATIENT_PK PRIMARY KEY(PATIENT_ID),
CONSTRAINT ADMIN_FK FOREIGN KEY(ADMIN_ID) REFERENCES ADMIN_USER(ADMIN_ID),
CONSTRAINT STATE_ID1_FK FOREIGN KEY(STATE_ID) REFERENCES STATES(STATE_ID)
);

CREATE TABLE PLASMA_BANK(
PLASMA_ID INT,
STATE_ID INT,
DONATED_DATE DATETIME,
BLOOD_GROUP VARCHAR(10) NOT NULL,
ADMIN_ID INT NOT NULL,
CONSTRAINT PLASMA_ID_PK PRIMARY KEY(PLASMA_ID),
CONSTRAINT ADMIN_ID2_FK FOREIGN KEY(ADMIN_ID) REFERENCES ADMIN_USER (ADMIN_ID),
CONSTRAINT STATE_ID_FK FOREIGN KEY(STATE_ID) REFERENCES STATES (STATE_ID)
);

CREATE TABLE DONOR(
NAME VARCHAR(10),
GENDER VARCHAR(10),
STATE_ID INT,
BLOOD_GROUP VARCHAR(20) NOT NULL,
PHONE_NO BIGINT NOT NULL,
AGE INT NOT NULL,
DONOR_ID VARCHAR(10) NOT NULL,
REG_ID VARCHAR(10),
REG_DATE DATETIME,
QUANTITY VARCHAR(10),
DONATED_DATE DATETIME NOT NULL,
PLASMA_ID INT ,
SSN_NO BIGINT NOT NULL,
SUFFERING_FROM_SERIOUS_ILLNESS VARCHAR(20),
CONSTRAINT ILL_CK CHECK(SUFFERING_FROM_SERIOUS_ILLNESS IN ('YES','NO','Yes','No','yes','no')),
CONSTRAINT SSN_PK PRIMARY KEY(SSN_NO),
CONSTRAINT STATE_ID_3 FOREIGN KEY(STATE_ID) REFERENCES STATES(STATE_ID)
);

CREATE TABLE REQUEST(
    REQ_ID INT NOT NULL,
    STATE_ID INT NOT NULL,
    BLOOD_GROUP VARCHAR(10)  NOT NULL,
PLASMA_ID INT NOT NULL,
NAME VARCHAR(20) NOT NULL,
QUANTITY VARCHAR(10),
REQUEST_DATE DATETIME,
PHONE_NO BIGINT,
CONSTRAINT REQ_ID_PK PRIMARY KEY(REQ_ID),
CONSTRAINT PLASM_FK FOREIGN KEY(PLASMA_ID) REFERENCES PLASMA_BANK(PLASMA_ID)
)

----------------------------------INSERT VALUES-----------------------------------------------------------



--DATA OF ADMIN_USER
INSERT INTO ADMIN_USER(ADMIN_ID,AUTHENTICATE_USER)
VALUES(1,1001);

INSERT INTO ADMIN_USER(ADMIN_ID,AUTHENTICATE_USER)
VALUES(2,1002);

INSERT INTO ADMIN_USER(ADMIN_ID,AUTHENTICATE_USER)
VALUES(3,1003);

--DATA OF USER_USER_LOGIN 
INSERT INTO USER_LOGIN(USERNAME,PASSWORD,ADMIN_ID) 
VALUES('KARAN','KB@12345',1);

INSERT INTO USER_LOGIN(USERNAME,PASSWORD,ADMIN_ID) 
VALUES('RYAN','RP@67891',2);

INSERT INTO USER_LOGIN(USERNAME,PASSWORD,ADMIN_ID) 
VALUES('THEJASWINI','TR@23456',1);

INSERT INTO USER_LOGIN(USERNAME,PASSWORD,ADMIN_ID) 
VALUES('ADI432','123aaaDI45',1);

INSERT INTO USER_LOGIN(USERNAME,PASSWORD,ADMIN_ID) 
VALUES('JAJS100','JS22@345',2);


--------------DATA OF STATE-------------------------------

INSERT INTO STATES( STATE_ID, STATE_NAME)
VALUES(001, 'NEW YORK')

INSERT INTO STATES( STATE_ID, STATE_NAME)
VALUES(002, 'CALIFORNIA')

INSERT INTO STATES( STATE_ID, STATE_NAME)
VALUES(003, 'TEXAS')

INSERT INTO STATES( STATE_ID, STATE_NAME)
VALUES(004, 'FLORIDA')

INSERT INTO STATES( STATE_ID, STATE_NAME)
VALUES(005, 'ARIZONA')

INSERT INTO STATES( STATE_ID, STATE_NAME)
VALUES(006, 'WASHINGTON')

INSERT INTO STATES( STATE_ID, STATE_NAME)
VALUES(007, 'NEW JERSEY')

INSERT INTO STATES( STATE_ID, STATE_NAME)
VALUES(008, 'HAWAII')

INSERT INTO STATES( STATE_ID, STATE_NAME)
VALUES(009, 'VIRGINIA')

INSERT INTO STATES( STATE_ID, STATE_NAME)
VALUES(000, 'ALASKA')

--DATA OF PATIENT
INSERT INTO PATIENT(NAME,GENDER,STATE_ID,PATIENT_ID,REG_ID,BLOOD_GROUP,PHONE_NO,AGE,ADMIN_ID, QUANTITY,REG_DATE,PLASMA_ID)
VALUES('SHUBHAM','MALE',002,1,'A01','O+',9239932929,19,1,'200ML',15/1/2020,107);

INSERT INTO PATIENT(NAME,GENDER,STATE_ID,PATIENT_ID,REG_ID,BLOOD_GROUP,PHONE_NO,AGE,ADMIN_ID,QUANTITY,REG_DATE,PLASMA_ID)
VALUES('SMITHA','FEMALE',001,2,'A02','O-',9239932920,18,1,'200ML',22/2/2020,108);

INSERT INTO PATIENT(NAME,GENDER,STATE_ID,PATIENT_ID,REG_ID,BLOOD_GROUP,PHONE_NO,AGE,ADMIN_ID,QUANTITY,REG_DATE,PLASMA_ID)
VALUES('DEEKSHITH','MALE',003,3,'B01','AB+',9239932921,23,1,'400ML',30/3/2020,105);

INSERT INTO PATIENT(NAME,GENDER,STATE_ID,PATIENT_ID,REG_ID,BLOOD_GROUP,PHONE_NO,AGE,ADMIN_ID,QUANTITY,REG_DATE,PLASMA_ID)
VALUES('SAHAJ','MALE',004,4,'B02','AB-',977932923,29,2,'450ML',14/4/2020,106);

INSERT INTO PATIENT(NAME,GENDER,STATE_ID,PATIENT_ID,REG_ID,BLOOD_GROUP,PHONE_NO,AGE,ADMIN_ID,QUANTITY,REG_DATE,PLASMA_ID)
VALUES('ROSS','MALE',005,5,'C01','AB-',9239112929,32,1,'480ML',5/5/2020,106);

INSERT INTO PATIENT(NAME,GENDER,STATE_ID,PATIENT_ID,REG_ID,BLOOD_GROUP,PHONE_NO,AGE,ADMIN_ID,QUANTITY,REG_DATE,PLASMA_ID)
VALUES('SELENA','FEMALE',007,6,'C02','B+',9239112924,42,1,'400ML',16/6/2020,103);

INSERT INTO PATIENT(NAME,GENDER,STATE_ID,PATIENT_ID,REG_ID,BLOOD_GROUP,PHONE_NO,AGE,ADMIN_ID,QUANTITY,REG_DATE,PLASMA_ID)
VALUES('CLAIRE','FEMALE',006,7,'D01','B-',9239112926,23,2,'380ML',17/7/2020,104);

INSERT INTO PATIENT(NAME,GENDER,STATE_ID,PATIENT_ID,REG_ID,BLOOD_GROUP,PHONE_NO,AGE,ADMIN_ID,QUANTITY,REG_DATE,PLASMA_ID)
VALUES('SAMUEL','MALE',008,8,'D02','AB-',9239112930,22,1,'300ML',8/8/2020,106);

INSERT INTO PATIENT(NAME,GENDER,STATE_ID,PATIENT_ID,REG_ID,BLOOD_GROUP,PHONE_NO,AGE,ADMIN_ID,QUANTITY,REG_DATE,PLASMA_ID)
VALUES('GRACE','FEMALE',009,9,'E01','A+',7431129249,62,2,'400ML',19/9/2020,101);

INSERT INTO PATIENT(NAME,GENDER,STATE_ID,PATIENT_ID,REG_ID,BLOOD_GROUP,PHONE_NO,AGE,ADMIN_ID,QUANTITY,REG_DATE,PLASMA_ID)
VALUES('RIYA','FEMALE',000,10,'E02','A-',9299112929,40,1,'390ML',10/10/2020,102);

--DATA OF PLASMA_BANK
INSERT INTO PLASMA_BANK(PLASMA_ID,STATE_ID,DONATED_DATE,BLOOD_GROUP,ADMIN_ID)
VALUES(101,009,19/9/2020,'A+',1);

INSERT INTO PLASMA_BANK(PLASMA_ID,STATE_ID,DONATED_DATE,BLOOD_GROUP,ADMIN_ID)
VALUES(102,001,10/10/2020,'A-',2);

INSERT INTO PLASMA_BANK(PLASMA_ID,STATE_ID,DONATED_DATE,BLOOD_GROUP,ADMIN_ID)
VALUES(103,007,16/6/2020,'B+',1);

INSERT INTO PLASMA_BANK(PLASMA_ID,STATE_ID,DONATED_DATE,BLOOD_GROUP,ADMIN_ID)
VALUES(104,006,17/7/2020,'B-',2);

INSERT INTO PLASMA_BANK(PLASMA_ID,STATE_ID,DONATED_DATE,BLOOD_GROUP,ADMIN_ID)
VALUES(105,007,3/3/2020,'AB+',2);

INSERT INTO PLASMA_BANK(PLASMA_ID,STATE_ID,DONATED_DATE,BLOOD_GROUP,ADMIN_ID)
VALUES(106,005,5/5/2020,'AB-',1);

INSERT INTO PLASMA_BANK(PLASMA_ID,STATE_ID,DONATED_DATE,BLOOD_GROUP,ADMIN_ID)
VALUES(107,002,10/1/2020,'O+',1);

INSERT INTO PLASMA_BANK(PLASMA_ID,STATE_ID,DONATED_DATE,BLOOD_GROUP,ADMIN_ID)
VALUES(108,001,2/2/2020,'O-',1);

INSERT INTO PLASMA_BANK(PLASMA_ID,STATE_ID,DONATED_DATE,BLOOD_GROUP,ADMIN_ID)
VALUES(110,003,6/6/2020,'B+',1);

INSERT INTO PLASMA_BANK(PLASMA_ID,STATE_ID,DONATED_DATE,BLOOD_GROUP,ADMIN_ID)
VALUES(109,006,17/7/2020,'B+',2);

--DATA OF DONOR
INSERT INTO DONOR(NAME,GENDER,STATE_ID,BLOOD_GROUP,DONOR_ID,PHONE_NO,AGE,SSN_NO,SUFFERING_FROM_SERIOUS_ILLNESS,QUANTITY,DONATED_DATE,PLASMA_ID)
VALUES('ALEX','MALE',009,'A+','A03',6310039133,19,5400129240134010,'NO','400ML',9/9/2020,101);

INSERT INTO DONOR(NAME,GENDER,STATE_ID,BLOOD_GROUP,DONOR_ID,PHONE_NO,AGE,SSN_NO,SUFFERING_FROM_SERIOUS_ILLNESS,QUANTITY,DONATED_DATE,PLASMA_ID)
VALUES('ABHISH','MALE',000,'A-','A04',631011133,29,5400129240134011,'NO','390ML',10/1/2020,102);

INSERT INTO DONOR(NAME,GENDER,STATE_ID,BLOOD_GROUP,DONOR_ID,PHONE_NO,AGE,SSN_NO,SUFFERING_FROM_SERIOUS_ILLNESS,QUANTITY,DONATED_DATE,PLASMA_ID)
VALUES('HAILEY','FEMALE',003,'B+','B03',631003133,49,5400129240134012,'NO','400ML',6/6/2020,103);

INSERT INTO DONOR(NAME,GENDER,STATE_ID,BLOOD_GROUP,DONOR_ID,PHONE_NO,AGE,SSN_NO,SUFFERING_FROM_SERIOUS_ILLNESS,QUANTITY,DONATED_DATE,PLASMA_ID)
VALUES('BARRY','MALE',004,'B-','B04',6310039003,32,5400129240134013,'NO','380ML',7/7/2020,104);

INSERT INTO DONOR(NAME,GENDER,STATE_ID,BLOOD_GROUP,DONOR_ID,PHONE_NO,AGE,SSN_NO,SUFFERING_FROM_SERIOUS_ILLNESS,QUANTITY,DONATED_DATE,PLASMA_ID)
VALUES('KENDAL','FEMALE',007,'AB+','C03',6310039773,19,5400129240134014,'NO','400ML',3/3/2020,105);

INSERT INTO DONOR(NAME,GENDER,STATE_ID,BLOOD_GROUP,DONOR_ID,PHONE_NO,AGE,SSN_NO,SUFFERING_FROM_SERIOUS_ILLNESS,QUANTITY,DONATED_DATE,PLASMA_ID)
VALUES('RIA','FEMALE',008,'AB-','C04',6310032111,34,5400129240134015,'NO','450ML',4/4/2020,106);

INSERT INTO DONOR(NAME,GENDER,STATE_ID,BLOOD_GROUP,DONOR_ID,PHONE_NO,AGE,SSN_NO,SUFFERING_FROM_SERIOUS_ILLNESS,QUANTITY,DONATED_DATE,PLASMA_ID)
VALUES('AKON','MALE',002,'O+','E03',6311139133,43,5400129240134016,'NO','200ML',10/1/2020,107);

INSERT INTO DONOR(NAME,GENDER,STATE_ID,BLOOD_GROUP,DONOR_ID,PHONE_NO,AGE,SSN_NO,SUFFERING_FROM_SERIOUS_ILLNESS,QUANTITY,DONATED_DATE,PLASMA_ID)
VALUES('TROY','MALE',001,'O-','E04',6310039188,19,5400129240134017,'NO','200ML',2/2/2020,108);

INSERT INTO DONOR(NAME,GENDER,STATE_ID,BLOOD_GROUP,DONOR_ID,PHONE_NO,AGE,SSN_NO,SUFFERING_FROM_SERIOUS_ILLNESS,QUANTITY,DONATED_DATE,PLASMA_ID)
VALUES('NICK','MALE',005,'O+','D03',6309129133,29,5400129240134018,'NO','390ML',10/10/2020,107);

INSERT INTO DONOR(NAME,GENDER,STATE_ID,BLOOD_GROUP,DONOR_ID,PHONE_NO,AGE,SSN_NO,SUFFERING_FROM_SERIOUS_ILLNESS,QUANTITY,DONATED_DATE,PLASMA_ID)
VALUES('JASMINE','FEMALE',006,'AB+','D04,',6310039133,24,5400129240134019,'NO','390ML',10/10/2020,105);


--DATE OF REQUEST TABLE------
INSERT INTO REQUEST(REQ_ID,STATE_ID,BLOOD_GROUP,PLASMA_ID,NAME,QUANTITY,REQUEST_DATE,PHONE_NO)
VALUES(91, 001, 'A+', 101, 'JULIA', '450ML', 1/1/2021, 23456789)

INSERT INTO REQUEST(REQ_ID,STATE_ID,BLOOD_GROUP,PLASMA_ID,NAME,QUANTITY,REQUEST_DATE,PHONE_NO)
VALUES(92, 002, 'A+', 101, 'KRITI', '420ML', 1/10/2021, 23455589)

INSERT INTO REQUEST(REQ_ID,STATE_ID,BLOOD_GROUP,PLASMA_ID,NAME,QUANTITY,REQUEST_DATE,PHONE_NO)
VALUES(93, 001, 'A+', 101, 'JUSTIN', '450ML', 5/1/2021, 27776789)

INSERT INTO REQUEST(REQ_ID,STATE_ID,BLOOD_GROUP,PLASMA_ID,NAME,QUANTITY,REQUEST_DATE,PHONE_NO)
VALUES(94, 006, 'O+', 107, 'JOHN', '400ML', 1/7/2021, 20056789)

INSERT INTO REQUEST(REQ_ID,STATE_ID,BLOOD_GROUP,PLASMA_ID,NAME,QUANTITY,REQUEST_DATE,PHONE_NO)
VALUES(95, 008, 'AB+', 106, 'JACK', '350ML', 1/1/2021, 43456789)

INSERT INTO REQUEST(REQ_ID,STATE_ID,BLOOD_GROUP,PLASMA_ID,NAME,QUANTITY,REQUEST_DATE,PHONE_NO)
VALUES(96, 001, 'AB+', 106, 'JULIA', '250ML', 1/1/2021, 44456789)

SELECT * FROM PLASMA_BANK
SELECT * FROM DONOR
SELECT * FROM PATIENT
SELECT * FROM USER_LOGIN
SELECT * FROM ADMIN_USER
SELECT * FROM STATES
SELECT * FROM REQUEST

---------------------------------------USE CASES-------------------------------------------------------------------------------

----1] NUMBER OF PATIENTS REQUESTING PLASMA FROM NEWYORK ON 1/1/2021 (BC: NUMBER OF REQUESTS FROM EACH STATE ON A PARTICULAR DATE)

SELECT COUNT(*) as no_of_requests FROM REQUEST R
JOIN STATES S ON R.STATE_ID=S.STATE_ID
WHERE S.STATE_NAME = 'NEW YORK'
AND R.REQUEST_DATE=1/1/2021

----2] RETRIEVE NAME AND PHONE NUMBERS OF PLASMA DONATORS FROM CALIFORNIA WITH BLOOD GROUP O+ (BC: RETRIEVE INFORMATION OF DONORS FROM REQUIRED STATE WITH A PARTICULAR BLOOD TYPE  )

SELECT D.NAME,D.GENDER, D.PHONE_NO, D.DONATED_DATE
FROM DONOR D JOIN STATES S 
ON D.STATE_ID=S.STATE_ID
WHERE S.STATE_NAME='CALIFORNIA' AND
D.BLOOD_GROUP = 'O+'

----3] TYPE OF PLASMA REQUESTED MAXIMUM NUMBER OF TIMES? (BC: HIGHLY DEMANDED PLASMA TYPE)

SELECT top 3 PLASMA_ID, 
COUNT(PLASMA_ID) AS FREQUENCY, BLOOD_GROUP 
FROM REQUEST
GROUP BY PLASMA_ID, BLOOD_GROUP
ORDER BY FREQUENCY DESC;

----4] RATIO OF MALE DONORS TO FEMALE DONORS?  (BC:RATIO OF MALE AND FEMALE DONORS)

SELECT 
    (CAST((SELECT COUNT(*) FROM DONOR WHERE Gender='MALE') AS FLOAT) / 
     CAST((SELECT COUNT(*) FROM DONOR WHERE Gender='FEMALE') AS FLOAT)) 
    AS ratioMaleFemale;

-----5] TYPE OF PLASMA DONATED IN HIGH QUANTITY  

SELECT TOP 5 PLASMA_ID, BLOOD_GROUP, SUM(CAST(LEFT(QUANTITY,3) AS int)) 
AS QUANTITY
FROM DONOR 
GROUP BY PLASMA_ID, BLOOD_GROUP
ORDER BY QUANTITY DESC;

